version: '3.8'

services:
  # Main Pipeline + Gradio App
  # Run on Lightning AI
  pipeline-app:
    image: image-to-3d:latest
    container_name: image_to_3d_pipeline
    environment:
      - LIGHTNING_API_KEY=${LIGHTNING_API_KEY}
      - PYTHONUNBUFFERED=1
      - CUDA_VISIBLE_DEVICES=0
    volumes:
      - ./outputs:/app/outputs
      - ./assets:/app/assets
      - ./logs:/app/logs
    ports:
      - "7860:7860"
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 8G
    command: python integrated_app.py
